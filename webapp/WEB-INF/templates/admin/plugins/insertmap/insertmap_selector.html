<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<div class="insert-service">
	<form action="jsp/admin/plugins/insertmap/DoInsertMap.jsp" class="form" name="newMapForm">
	<input type="hidden" name="input" value="${input}" />
	<input type="hidden" name="width" value="400" />
	<input type="hidden" name="height" value="400"/>
	<input type="hidden" name="lat" value=""/>
	<input type="hidden" name="lng" value=""/>
	<input type="hidden" name="zoom" value="14"/>
 	<p>#i18n{insertmap.message.addressChoose}</p>
	<input id="address" name="address" value="227 rue de bercy, paris, france" type="text" class="input-normal" onchange="generateMap()" >
	<button type="button" class="btn btn-primary btn-small" onclick="codeAddress();" >
		<i class="icon-eye-open icon-white"></i>&nbsp;#i18n{insertmap.button.preview}
	</button>
	<button type="submit" class="btn btn-primary btn-small"  onclick="validateAddress();" >
		<i class="icon-ok icon-white"></i>&nbsp;#i18n{insertmapbutton.validate}
	</button>
	<div class="well well-small">
	<button type="button" class="btn btn-primary btn-mini" onclick="changeSize('-');" >
		<i class="icon-minus icon-white"></i>
	</button>
	<button type="button" class="btn btn-primary btn-mini" value="+" onclick="changeSize('+');" >
		<i class="icon-plus icon-white"></i>
	</button>
	#i18n{insertmap.message.zoomSize}
	<button type="button" class="btn btn-primary btn-mini" onclick="zoomZoom('-');" >
		<i class="icon-minus icon-white"></i>
	</button>
	<button type="button" class="btn btn-primary btn-mini" value="+" onclick="zoomZoom('+');" >
		<i class="icon-plus icon-white"></i>
	</button>
	#i18n{insertmap.message.zoomZoom}
	</div>
	</form>
	<div id="map-canvas"></div>
</div>
<script type="text/javascript">
	var OFFSET = 20;
	var geocoder;
	var map;
	var form = document.forms.newMapForm;

	function initialize() {
		geocoder = new google.maps.Geocoder();
		var mapOptions = {
			zoom : eval(document.forms.newMapForm.zoom.value),
			disableDefaultUI : true
		}
		map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
		var mapDiv = document.getElementById('map-canvas');
		mapDiv.style.width = form.width.value + "px";
		mapDiv.style.height = form.height.value + "px";
		codeAddress();
	}

	function codeAddress() {
		var address = document.getElementById('address').value;
		geocoder.geocode({
			'address' : address
		}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				map.setCenter(results[0].geometry.location);
				form.lat.value = results[0].geometry.location.nb;
				form.lng.value = results[0].geometry.location.ob;
				var marker = new google.maps.Marker({
					map : map,
					position : results[0].geometry.location
				});
			} else {
				alert('Geocode was not successful for the following reason: '
						+ status);
			}
		});
	}

	google.maps.event.addDomListener(window, 'load', initialize);

	function changeSize(command) {
		if (command == "-") {
			form.width.value = form.width.value - OFFSET;
			form.height.value = form.height.value - OFFSET;
		} else {
			form.width.value = eval(form.width.value) + OFFSET;
			form.height.value = eval(form.height.value) + OFFSET;
		}
		initialize();
	}

	function zoomZoom(command) {
		if (command == "-") {
			form.zoom.value = form.zoom.value - 1;
		} else {
			form.zoom.value = eval(form.zoom.value) + 1;
		}
		initialize();
	}
</script>
