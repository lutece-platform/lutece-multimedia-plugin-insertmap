<script src="http://maps.google.com/maps?file=api&v=2&key=${gkey}" type="text/javascript"></script>
<div class="insert-service">
	<form action="jsp/admin/plugins/insertmap/DoInsertMap.jsp" name="newMapForm">
	<input type="hidden" name="input" value="${input}" />
	<input type="hidden" name="x" value="2.35" />
	<input type="hidden" name="y" value="48.86" />
	<input type="hidden" name="width" value="300" />
	<input type="hidden" name="height" value="250"/>
	<input type="hidden" name="zoom" value="14"/>

	#i18n{insertmap.message.mapChoose}<br />
	<input type="radio" name="mapName" value="google" id="google" /> #i18n{insertmap.message.google.normal}<br />
	<input type="radio" name="mapName" value="googlestatic" id="googlestatic" checked="checked" /> #i18n{insertmap.message.google.static}<br />
	<input id="gkey" name="gkey" value="${gkey}" type="hidden" size="45" /><br />

	#i18n{insertmap.message.addressChoose}<br />
	<input id="address" name="address" value="" type="text" size="45" onchange="moveMap()" />
	<input type="button" value="PrÃ©visualiser" onclick="moveMap()" />
	<input type="button" value="Valider" onclick="validateAddress()" /><br />
	<br />
	<input type="button" value="-" onclick="zoomFunction('-')" />
	<input type="button" value="+" onclick="zoomFunction('+')" />
	#i18n{insertmap.message.zoomSize}<br />
	<input type="button" value="-" onclick="zoomZoom('-')" />
	<input type="button" value="+" onclick="zoomZoom('+')" />
	#i18n{insertmap.message.zoomZoom}<br />
	</form>
	<br />
	<img id="map" />
</div>
<script language="JavaScript" type="text/javascript">

	var offset = 20;
	
	function generateMap()
	{
		var map = document.getElementById("map");
		var form = document.forms.newMapForm;
		var newUrl = "http://maps.google.com/staticmap?center="+
				form.y.value +","+
				form.x.value+"&zoom="+
				form.zoom.value+"&size="+
				form.width.value+"x"+
				form.height.value+"&markers="+
				form.y.value+","+
				form.x.value+"&maptype=mobile&key="+
				form.gkey.value+"&sensor=false";
		map.src = newUrl;
		var mapDiv = document.getElementById("map");
		mapDiv.style.width = form.width.value + "px";
		mapDiv.style.height = form.height.value + "px";
	}
	
	function moveMap()
	{
		var address = document.getElementById("address").value;
		if( address!=null && address.length>0 )
		{
			var geocoder = new GClientGeocoder;
			try
			{
				geocoder.getLatLng(address, function(point) {
					if( point == null )
					{
						alert("#i18n{insertmap.message.addressNotFound}");
					} else {
						document.forms.newMapForm.x.value = point.x;
						document.forms.newMapForm.y.value = point.y;
						generateMap();
					}
				});
			}
			catch(err)
			{
				alert(err.description);
			}
		}
		else 
		{
			alert("#i18n{insertmap.message.addressEmpty}");
		}
	}

	function validateAddress()
	{
		document.forms.newMapForm.submit();
	}
	
	function zoomFunction(command)
	{
		var form = document.forms.newMapForm;
		if( command == "-" )
		{
			form.width.value = form.width.value - offset;
			form.height.value = form.height.value - offset;
		} else {
			form.width.value = eval(form.width.value) + offset;
			form.height.value = eval(form.height.value) + offset;
		}
		generateMap();
	}
	
	function zoomZoom(command)
	{
		var form = document.forms.newMapForm;
		if( command == "-" )
		{
			form.zoom.value = form.zoom.value - 1;
		} else {
			form.zoom.value = eval(form.zoom.value) + 1;
		}
		generateMap();
	}
	
</script>
